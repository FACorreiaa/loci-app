2025-10-23T15:37:40.874+0100    ERROR   handlers/chat.go:1003   Failed to process authenticated chat stream     {"port": "8090", "service": "loci-templui", "line": "42", "error": "failed to parse message: failed to parse message: doRequest: error sending request: Post \"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent\": context canceled"}
2025/10/23 15:37:40 ERROR Unprocessed event sent to dead letter queue event="{Type:error Message: Data:<nil> Error:failed to parse message: doRequest: error sending request: Post \"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent\": context canceled Timestamp:2025-10-23 15:37:40.874278 +0100 WEST m=+36.183470126 EventID:f75d29d2-a4ca-4cb3-9a4f-2d68a438511d IsFinal:false Navigation:<nil>}"

I get this error message when I search for a Restaurant like "Restaurant in Rio".
If I search for an Itinerary, everything works properly with all displayed data.
Searching for Restaurants, Itineraries, Hotels and Activities use the same endpoint, with the LLM having a domain detection
So everything should work for all the handlers. Check why my Restaurants are failing. 
It goes to an empty page with:

Finding restaurants...

This may take a few moments

If I search for hotels:
Returns an empty page. 

If I search for activities:
Returns an empty page despite having data on the terminal 

-23T15:42:42.74346+01:00","event_id":"f1236e52-7640-4a07-9aa0-ac8dba441e1f"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"_range\": \"$\",\n            \"rating\": 4.5,\n            \"tags\": [\"museum\", \"science\", \"future\", \"interactive\", \"architecture\"],\n            \"images\": [],\n            \"distance\": 4.8\n        },\n        {\n            \"city\": \"Rio de Janeiro\",","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:42.968485+01:00","event_id":"08397a39-9f66-4413-bef1-8c5b16991220"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":" in shaping it. Offers interactive exhibits and stunning architecture.\",\n            \"address\": \"Praça Mauá, 1 - Centro, Rio de Janeiro - RJ, 20081-240, Brazil\",\n            \"","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:43.032394+01:00","event_id":"df4569cd-2473-4757-b17c-ec2a22f6c997"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"website\": \"http://www.museudoamanha.org.br/\",\n            \"opening_hours\": \"Tue-Sun 10:00-18:00\",\n            \"price_range\": \"$\",","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:43.294805+01:00","event_id":"67d5afd6-048f-4c79-a3f3-94f5a70e6242"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"\n            \"name\": \"Candelária Church\",\n            \"latitude\": -22.9028,\n            \"longitude\": -43.1814,\n            \"category\": \"Cultural\",\n            \"description\": \"A magnificent historical church with impressive architecture and artwork. A significant landmark","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:43.493386+01:00","event_id":"62f3b874-7cc9-4438-be83-07cbf9c4758b"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"\n            \"rating\": 4.5,\n            \"tags\": [\"Science\", \"Sustainability\", \"Architecture\", \"Interactive Exhibits\"],\n            \"images\": [],\n            \"distance\": 4.8\n        },\n        {\n            \"city\": \"Rio de Janeiro\",\n            \"name\":","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:43.647414+01:00","event_id":"26487675-67a9-4f32-a654-5c7513f047d0"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":" in Rio's history and a beautiful place for quiet contemplation.\",\n            \"address\": \"Praça Pio X, s/n - Centro, Rio de Janeiro - RJ, 20040-020, Brazil\",\n            \"website\": \"http://www.candelaria.rio","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:43.970319+01:00","event_id":"ee109917-0467-4b8c-a534-46604395e7df"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":" \"Candelária Church\",\n            \"latitude\": -22.9017,\n            \"longitude\": -43.1798,\n            \"category\": \"Cultural\",\n            \"description\": \"A historical church with stunning architecture and intricate details. A significant landmark in Rio's history.\",","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:44.083906+01:00","event_id":"eaaf7bde-514c-414f-a277-88d01fc57a6b"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":".br/\",\n            \"opening_hours\": \"Mon-Fri 07:30-16:30, Sat-Sun 09:00-13:00\",\n            \"price_range\": \"Free\",\n            \"rating\": 4.6,\n            \"","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:44.393717+01:00","event_id":"29425d58-2e8a-49dc-a03d-798db699cf77"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"\n            \"address\": \"Praça Pio X, s/n - Centro, Rio de Janeiro - RJ, 20040-020, Brazil\",\n            \"website\": \"http://www.candelaria.rio.br/\",\n            \"opening_hours\": \"Mon-Fri","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:44.59771+01:00","event_id":"fb3079cc-1d14-4d7d-9518-e4300f7490c3"}
2025/10/23 15:42:44 traces export: parse "http://http:%2F%2Fotel-collector:4318/v1/traces": invalid URL escape "%2F"
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"tags\": [\"church\", \"architecture\", \"history\", \"religion\", \"landmark\"],\n            \"images\": [],\n            \"distance\": 4.5\n        },\n        {\n            \"city\": \"Rio de Janeiro\",\n            \"name\": \"AquaRio\",\n            \"latitude\": -22","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:44.774069+01:00","event_id":"185bc7f4-aa10-4b27-9625-ddae194f88f1"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":" 7:30-16:30, Sat 9:00-13:00, Sun 9:00-12:00\",\n            \"price_range\": \"Free\",\n            \"rating\": 4.6,\n            \"tags\": [\"Church","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:44.9703+01:00","event_id":"092e6a79-f59c-4521-b05f-d96bc7cc88ed"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":".8947,\n            \"longitude\": -43.1822,\n            \"category\": \"Entertainment\",\n            \"description\": \"The largest marine aquarium in South America, featuring thousands of animals from diverse aquatic ecosystems. Offers an immersive experience for visitors of all ages.\",\n            \"address","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:45.304702+01:00","event_id":"67027f57-9ef6-4084-9294-7fe9aa2891ea"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"\", \"Architecture\", \"History\", \"Landmark\"],\n            \"images\": [],\n            \"distance\": 4.9\n        },\n        {\n            \"city\": \"Rio de Janeiro\",\n            \"name\": \"AquaRio\",\n            \"latitude\": -22.8939","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:45.367237+01:00","event_id":"e7dde83d-cdb4-418a-a804-eb3d5d961b74"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":",\n            \"longitude\": -43.1856,\n            \"category\": \"Entertainment\",\n            \"description\": \"The largest marine aquarium in South America, featuring thousands of animals from various marine ecosystems.\",\n            \"address\": \"Via Binário do Porto, 194 - Gamb","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:45.916111+01:00","event_id":"9e15deb9-3c1f-43b5-ba16-5d3aa276554d"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"\": \"Via Binário do Porto, 194 - Gamboa, Rio de Janeiro - RJ, 20220-360, Brazil\",\n            \"website\": \"https://www.aquariomarinhodorio.com.br/\",\n            \"opening_hours\": \"Mon","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:45.916112+01:00","event_id":"69e06038-421a-4a93-af71-e93d3c0b1786"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"-Sun 09:00-18:00\",\n            \"price_range\": \"$$\",\n            \"rating\": 4.3,\n            \"tags\": [\"aquarium\", \"marine life\", \"animals\", \"family\", \"entertainment\"],\n            \"images\": [],\n            ","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:46.326577+01:00","event_id":"9fd3f79c-b004-47ff-91a1-f0ed472f7455"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"oa, Rio de Janeiro - RJ, 20220-360, Brazil\",\n            \"website\": \"https://www.aquariomarinhodorio.com.br/\",\n            \"opening_hours\": \"Mon-Sun 09:00-18:00\",\n","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:46.326585+01:00","event_id":"81d2d3d5-f969-412a-9200-8747ff235194"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"\"distance\": 4.7\n        }\n    ]\n}\n```","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:46.373831+01:00","event_id":"27547082-4af2-4e27-9dc4-6fe9d126eb03"}
SSE >> {"type":"complete","message":"","data":{"session_id":"0c29f691-2625-4ef4-9760-611d6373e97b"},"timestamp":"2025-10-23T15:42:46.384108+01:00","event_id":"460f5c10-f4b2-46fe-963a-82b1967e22c7","navigation":{"url":"/activities?sessionId=0c29f691-2625-4ef4-9760-611d6373e97b\u0026cityName=Rio+de+Janeiro\u0026domain=activities","route_type":"activities","query_params":{"cityName":"Rio de Janeiro","domain":"activities","sessionId":"0c29f691-2625-4ef4-9760-611d6373e97b"}}}
2025/10/23 15:42:46 INFO Event channel closed by completion goroutine
2025-10-23T15:42:46.384+0100    INFO    handlers/chat.go:1051   Stream completed        {"port": "8090", "service": "loci-templui", "line": "42", "eventType": "complete"}
2025-10-23T15:42:46.385+0100    INFO    middleware/middleware.go:78     HTTP Request    {"port": "8090", "service": "loci-templui", "line": "42", "method": "GET", "path": "/chat/stream?session_id=b08996ea-0106-4eac-8a81-bbcec2ddf149&dashboard-search=Activity+in+Rio+de+Janeiro&profile-id=812186e8-2c68-43ea-8306-f9223c01e42e", "ip": "::1", "status": 200, "latency": 6.857073791, "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
SSE >> {"type":"chunk","message":"","data":{"cache_key":"8a477979a117fd0c124388173f5dec34_activities","cache_used":true,"chunk":"            \"price_range\": \"$$\",\n            \"rating\": 4.3,\n            \"tags\": [\"Aquarium\", \"Marine Life\", \"Family Friendly\", \"Animals\"],\n            \"images\": [],\n            \"distance\": 4.9\n        }\n    ]\n}\n```","domain":"activities","part":"activities"},"timestamp":"2025-10-23T15:42:46.73709+01:00","event_id":"8332964a-a101-4fa3-bbf2-e3adcf9066da"}
2025/10/23 15:42:46 INFO Event channel closed by completion goroutine
SSE >> {"type":"complete","message":"","data":{"session_id":"7d1504f9-755f-4419-b094-164cb67560d8"},"timestamp":"2025-10-23T15:42:46.737412+01:00","event_id":"06219f35-d35f-4ca9-8ce6-44b4d6f536dd","navigation":{"url":"/activities?sessionId=7d1504f9-755f-4419-b094-164cb67560d8\u0026cityName=Rio+de+Janeiro\u0026domain=activities","route_type":"activities","query_params":{"cityName":"Rio de Janeiro","domain":"activities","sessionId":"7d1504f9-755f-4419-b094-164cb67560d8"}}}
2025-10-23T15:42:46.738+0100    INFO    handlers/chat.go:1051   Stream completed        {"port": "8090", "service": "loci-templui", "line": "42", "eventType": "complete"}
2025-10-23T15:42:46.739+0100    INFO    middleware/middleware.go:78     HTTP Request    {"port": "8090", "service": "loci-templui", "line": "42", "method": "GET", "path": "/chat/stream?session_id=b08996ea-0106-4eac-8a81-bbcec2ddf149&dashboard-search=Activity+in+Rio+de+Janeiro&profile-id=812186e8-2c68-43ea-8306-f9223c01e42e", "ip": "::1", "status": 200, "latency": 7.191658209, "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-23T15:42:46.920+0100    INFO    handlers/activities.go:181      Activities SSE page accessed    {"port": "8090", "service": "loci-templui", "line": "42", "ip": "::1", "query": "", "sessionId": "0c29f691-2625-4ef4-9760-611d6373e97b"}
2025-10-23T15:42:46.921+0100    INFO    handlers/activities.go:197      Attempting to load activities from cache with SSE  {"port": "8090", "service": "loci-templui", "line": "42", "sessionID": "0c29f691-2625-4ef4-9760-611d6373e97b"}
2025-10-23T15:42:46.921+0100    INFO    handlers/activities.go:254      No activities found in cache. Rendering SSE loading interface.     {"port": "8090", "service": "loci-templui", "line": "42", "sessionID": "0c29f691-2625-4ef4-9760-611d6373e97b"}
2025-10-23T15:42:46.922+0100    INFO    middleware/middleware.go:78     HTTP Request    {"port": "8090", "service": "loci-templui", "line": "42", "method": "GET", "path": "/activities?sessionId=0c29f691-2625-4ef4-9760-611d6373e97b&cityName=Rio+de+Janeiro&domain=activities", "ip": "::1", "status": 200, "latency": 0.002561875, "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-23T15:42:47.591+0100    INFO    routes/routes.go:815    404 - Page not found    {"port": "8090", "service": "loci-templui", "line": "42", "path": "/static/images/icons/icon-144x144.png", "method": "GET", "ip": "::1"}
2025-10-23T15:42:47.591+0100    WARN    middleware/middleware.go:76     HTTP Request    {"port": "8090", "service": "loci-templui", "line": "42", "method": "GET", "path": "/static/images/icons/icon-144x144.png", "ip": "::1", "status": 404, "latency": 0.000711625, "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025/10/23 15:42:49 traces export: parse "http://http:%2F%2Fotel-collector:4318/v1/traces": invalid URL escape "%2F"
2025-10-23T15:42:56.120+0100    INFO    routes/routes.go:815    404 - Page not found    {"port": "8090", "service": "loci-templui", "line": "42", "path": "/metrics", "method": "GET", "ip": "127.0.0.1"}
2025-10-23T15:42:56.121+0100    WARN    middleware/middleware.go:76     HTTP Request    {"port": "8090", "service": "loci-templui", "line": "42", "method": "GET", "path": "/metrics", "ip": "127.0.0.1", "status": 404, "latency": 0.001997583, "user_agent": "Prometheus/3.5.0"}
2025/10/23 15:42:59 traces export: parse "http://http:%2F%2Fotel-collector:4318/v1/traces": invalid URL escape "%2F"
