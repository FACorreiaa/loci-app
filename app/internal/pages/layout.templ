package pages

import (
	"github.com/FACorreiaa/go-templui/app/internal/components/footer"
	mapcomponents "github.com/FACorreiaa/go-templui/app/internal/components/map"
	"github.com/FACorreiaa/go-templui/app/internal/components/navbar"
	"github.com/FACorreiaa/go-templui/app/internal/components/pwa"
	"github.com/FACorreiaa/go-templui/app/internal/components/scripts"
	"github.com/FACorreiaa/go-templui/app/internal/components/styles"
	"github.com/FACorreiaa/go-templui/app/internal/features/results"
	"github.com/FACorreiaa/go-templui/app/internal/models"
	"os"
)

templ LayoutPage(l models.LayoutTempl) {
	<!DOCTYPE html>
	<html lang="en">
		<head>
			<meta charset="utf-8"/>
			<meta name="viewport" content="width=device-width, initial-scale=1"/>
			<title>{ l.Title } - TemplUI</title>
			<meta name="description" content="Explore and discover amazing places with Loci, your personal travel assistant."/>
			<link rel="stylesheet" href="/assets/css/output.css"/>
			<link rel="preconnect" href="https://fonts.googleapis.com"/>
			<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
			<link rel="manifest" href="/static/manifest.json"/>
			<meta name="theme-color" content="#2563eb"/>
			<link rel="apple-touch-icon" href="/static/images/icons/icon-192x192.png"/>
			<link rel="icon" type="image/png" sizes="144x144" href="/static/images/icons/icon-144x144.png"/>
			<link rel="icon" type="image/png" sizes="192x192" href="/static/images/icons/icon-192x192.png"/>
			<link rel="icon" type="image/png" sizes="512x512" href="/static/images/icons/icon-512x512.png"/>
			<meta name="apple-mobile-web-app-capable" content="yes"/>
			<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
			<meta name="apple-mobile-web-app-title" content="Loci"/>
			<meta name="mobile-web-app-capable" content="yes"/>
			<meta name="application-name" content="Loci"/>
			<link
				href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
				rel="stylesheet"
			/>
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous"/>
			<style>
				[x-cloak] { display: none !important; }
			</style>
			<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js" integrity="sha384-ZBXiYtYQ6hJ2Y0ZNoYuI+Nq5MqWBr+chMrS/RkXpNzQCApHEhOt2aY8EJgqwHLkJ" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/htmx-ext-sse@2.2.2" integrity="sha384-BkCCd4DbvhfvRLfThp+5RN2KiB1FBROoAtwZFfceJishUnpFW1eF/aqG14M5TwA2" crossorigin="anonymous"></script>
			<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js" integrity="sha384-O8NPfezTLQ/sgLfQYBJEnezJLlum9L6KOqHsfIWauzaFfD1TQSuvA4iUpgWGHeuZ" crossorigin="anonymous"></script>
			@mapcomponents.MapboxScripts(os.Getenv("MAPBOX_API_KEY"))
			<script>
				// Initialize theme on page load
				document.addEventListener('DOMContentLoaded', function() {
					const theme = localStorage.getItem('theme') || 'light';
					if (theme === 'dark') {
						document.documentElement.classList.add('dark');
					}
				});
			</script>
			@results.ItineraryStateScript()
			@results.POIModalScript()
			@scripts.SessionManagerScript()
			@scripts.ViewModeManagerScript()
			@styles.AnimationsCSS()
		</head>
		<body hx-boost="true" class="min-h-screen bg-background text-foreground font-inter antialiased">
			<script type="module">
                          function registerServiceWorkers() {
                            // check if the browser supports service workers, otherwise abort.
                            if (!("serviceWorker" in navigator)) {
                              console.error("Browser doesn't support service workers");
                              return;
                            }
                            // it's really important to make sure that the app is fully loaded, since the service worker won't be loaded before that.
                            window.addEventListener("load", () => {
                              navigator.serviceWorker
                                // this is the service worker's path, since we put it under /static earlier, and static is already registered as a file server.
                                .register("/static/sw.js")
                                .then((reg) => {
                                  console.log("Service Worker Registered", reg);
                                })
                                .catch((err) => {
                                  console.log("Service Worker Registration failed:", err);
                                });
                            });
                          }
                          // call the function, you might wonder why isn't everything working as expected, but then it's just a missing function call :)
                          registerServiceWorkers();
                        </script>
			<div class="flex flex-col min-h-screen">
				@navbar.Navbar(navbar.Props{
					Nav:       l.Nav,
					User:      l.User,
					ActiveNav: l.ActiveNav,
				})
				<main class="flex-1">
					@l.Content
				</main>
				@footer.Footer(footer.Props{})
			</div>
			<!-- PWA Install Button -->
			@pwa.InstallButton()
		</body>
	</html>
}
