// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package nearby

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

func NearbyPage() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div class=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900\" x-data=\"nearbyApp()\" x-init=\"init()\"><div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16\"><!-- Header --><div class=\"mb-8\"><div class=\"flex items-center justify-between mb-6\"><div class=\"flex items-center gap-3\"><div class=\"w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center\"><svg class=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path> <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg></div><div><h1 class=\"text-2xl font-bold text-foreground\">Nearby Places</h1><p class=\"text-muted-foreground\">Discover amazing places as you move</p></div></div><!-- Connection Status --><div class=\"flex items-center gap-2\"><div class=\"flex items-center gap-2 px-3 py-2 rounded-lg border\" :class=\"wsConnected ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800' : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'\"><div class=\"w-2 h-2 rounded-full\" :class=\"wsConnected ? 'bg-green-500 animate-pulse' : 'bg-red-500'\"></div><span class=\"text-sm font-medium\" :class=\"wsConnected ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300'\" x-text=\"wsConnected ? 'Live' : 'Offline'\"></span></div></div></div></div><!-- Controls --><div class=\"bg-card rounded-xl shadow-lg border p-6 mb-8\"><div class=\"flex flex-col md:flex-row gap-4 mb-4\"><!-- Live Tracking Toggle --><div class=\"flex items-center gap-3 flex-1\"><button @click=\"toggleTracking\" :class=\"isTracking ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'\" class=\"px-6 py-3 text-white rounded-lg transition-all font-medium shadow-md flex items-center gap-2\"><svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path> <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg> <span x-text=\"isTracking ? 'Stop Tracking' : 'Start Live Tracking'\"></span></button><div x-show=\"isTracking\" class=\"text-sm text-muted-foreground\"><span class=\"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2\"></span> Tracking your location...</div></div><!-- Distance Radius --><div class=\"flex-1\"><label class=\"block text-sm font-medium text-muted-foreground mb-2\">Search Radius</label> <select x-model=\"radius\" @change=\"refreshPOIs\" class=\"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-background text-foreground\"><option value=\"0.5\">500m</option> <option value=\"1\">1 km</option> <option value=\"2\">2 km</option> <option value=\"5\" selected>5 km</option> <option value=\"10\">10 km</option> <option value=\"25\">25 km</option> <option value=\"50\">50 km</option></select></div></div><!-- Current Location Display --><div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg\"><div><span class=\"text-sm text-muted-foreground\">Latitude:</span> <span class=\"ml-2 font-mono text-sm\" x-text=\"currentLat.toFixed(6)\"></span></div><div><span class=\"text-sm text-muted-foreground\">Longitude:</span> <span class=\"ml-2 font-mono text-sm\" x-text=\"currentLon.toFixed(6)\"></span></div></div><p class=\"text-xs text-muted-foreground mt-3\">ðŸ’¡ Click \"Start Live Tracking\" to automatically discover places as you move. We'll update results when you move more than 50 meters.</p></div><!-- POI Results --><div id=\"nearby-results\"><div x-show=\"loading\" class=\"text-center py-12\"><div class=\"w-16 h-16 mx-auto mb-4 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin\"></div><p class=\"text-lg font-medium text-gray-700 dark:text-gray-300\">Finding nearby places...</p></div><div x-show=\"!loading && pois.length === 0 && !isTracking\" class=\"text-center py-12 text-muted-foreground\"><svg class=\"w-16 h-16 mx-auto mb-4 text-purple-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path> <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg><p class=\"text-lg font-medium mb-2\">Start discovering nearby places</p><p class=\"text-sm\">Click \"Start Live Tracking\" to begin</p></div><div x-show=\"!loading && pois.length > 0\"><h2 class=\"text-lg font-semibold text-foreground mb-4\" x-text=\"`${pois.length} Places Nearby`\"></h2><div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\"><template x-for=\"poi in pois\" :key=\"poi.id\"><div class=\"bg-card rounded-xl shadow-sm border hover:shadow-md transition-shadow\"><div class=\"p-6\"><div class=\"flex items-start justify-between mb-4\"><div class=\"flex items-center gap-3\"><span class=\"text-3xl\" x-text=\"poi.emoji\"></span><div class=\"flex flex-col gap-1\"><span class=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300\" x-text=\"poi.category\"></span><div class=\"flex items-center gap-1\"><svg class=\"w-4 h-4 text-yellow-500 fill-current\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"></path></svg> <span class=\"text-sm font-medium\" x-text=\"poi.rating.toFixed(1)\"></span></div></div></div><button :hx-post=\"`/favorites/add/${poi.id}`\" hx-target=\"this\" hx-swap=\"outerHTML\" class=\"p-2 text-muted-foreground hover:text-red-500 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200\" title=\"Add to favorites\"><svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path></svg></button></div><div class=\"space-y-3\"><h3 class=\"font-semibold text-card-foreground text-lg\" x-text=\"poi.name\"></h3><div class=\"flex items-center gap-2 text-sm text-muted-foreground\"><svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path> <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg> <span x-text=\"`${poi.distance.toFixed(2)} km away`\"></span></div><p class=\"text-muted-foreground text-sm line-clamp-2\" x-text=\"poi.description\"></p></div></div></div></template></div></div></div></div></div><script>\n\tfunction nearbyApp() {\n\t\treturn {\n\t\t\tws: null,\n\t\t\twsConnected: false,\n\t\t\tisTracking: false,\n\t\t\tcurrentLat: 38.7223, // Default Lisbon\n\t\t\tcurrentLon: -9.1393,\n\t\t\tlastLat: 0,\n\t\t\tlastLon: 0,\n\t\t\tradius: 5,\n\t\t\tpois: [],\n\t\t\tloading: false,\n\t\t\twatchId: null,\n\t\t\treconnectAttempts: 0,\n\t\t\tmaxReconnectAttempts: 5,\n\n\t\t\tinit() {\n\t\t\t\tthis.connectWebSocket();\n\t\t\t},\n\n\t\t\tconnectWebSocket() {\n\t\t\t\tconst protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n\n\t\t\t\t// Get JWT token from localStorage if available\n\t\t\t\tconst token = localStorage.getItem('jwt_token');\n\n\t\t\t\t// Build WebSocket URL with optional token\n\t\t\t\tlet wsUrl = `${protocol}//${window.location.host}/ws/nearby`;\n\t\t\t\tif (token) {\n\t\t\t\t\twsUrl += `?token=${token}`;\n\t\t\t\t\tconsole.log('ðŸ“± Connecting to WebSocket with authentication');\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('ðŸŒ Connecting to WebSocket as anonymous user');\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tthis.ws = new WebSocket(wsUrl);\n\n\t\t\t\t\tthis.ws.onopen = () => {\n\t\t\t\t\t\tconsole.log('WebSocket connected');\n\t\t\t\t\t\tthis.wsConnected = true;\n\t\t\t\t\t\tthis.reconnectAttempts = 0;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.ws.onmessage = (event) => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst data = JSON.parse(event.data);\n\t\t\t\t\t\t\tif (data.type === 'pois') {\n\t\t\t\t\t\t\t\tthis.pois = data.pois || [];\n\t\t\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\t\t} else if (data.type === 'error') {\n\t\t\t\t\t\t\t\tconsole.error('Server error:', data.message);\n\t\t\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error('Failed to parse message:', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.ws.onerror = (error) => {\n\t\t\t\t\t\tconsole.error('WebSocket error:', error);\n\t\t\t\t\t\tthis.wsConnected = false;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.ws.onclose = () => {\n\t\t\t\t\t\tconsole.log('WebSocket disconnected');\n\t\t\t\t\t\tthis.wsConnected = false;\n\n\t\t\t\t\t\t// Attempt to reconnect\n\t\t\t\t\t\tif (this.reconnectAttempts < this.maxReconnectAttempts) {\n\t\t\t\t\t\t\tthis.reconnectAttempts++;\n\t\t\t\t\t\t\tconst delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);\n\t\t\t\t\t\t\tconsole.log(`Reconnecting in ${delay}ms... (attempt ${this.reconnectAttempts})`);\n\t\t\t\t\t\t\tsetTimeout(() => this.connectWebSocket(), delay);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Failed to create WebSocket:', e);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\ttoggleTracking() {\n\t\t\t\tif (this.isTracking) {\n\t\t\t\t\tthis.stopTracking();\n\t\t\t\t} else {\n\t\t\t\t\tthis.startTracking();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tstartTracking() {\n\t\t\t\tif (!navigator.geolocation) {\n\t\t\t\t\talert('Geolocation is not supported by your browser');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.isTracking = true;\n\t\t\t\tthis.loading = true;\n\n\t\t\t\t// Get initial position\n\t\t\t\tnavigator.geolocation.getCurrentPosition(\n\t\t\t\t\t(position) => {\n\t\t\t\t\t\tthis.currentLat = position.coords.latitude;\n\t\t\t\t\t\tthis.currentLon = position.coords.longitude;\n\t\t\t\t\t\tthis.lastLat = this.currentLat;\n\t\t\t\t\t\tthis.lastLon = this.currentLon;\n\t\t\t\t\t\tthis.sendLocationUpdate();\n\t\t\t\t\t},\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\tconsole.error('Geolocation error:', error);\n\t\t\t\t\t\talert('Unable to get your location. Please check your permissions.');\n\t\t\t\t\t\tthis.isTracking = false;\n\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\t// Watch for position changes\n\t\t\t\tthis.watchId = navigator.geolocation.watchPosition(\n\t\t\t\t\t(position) => {\n\t\t\t\t\t\tconst newLat = position.coords.latitude;\n\t\t\t\t\t\tconst newLon = position.coords.longitude;\n\n\t\t\t\t\t\t// Only update if moved more than ~50 meters\n\t\t\t\t\t\tconst distance = this.calculateDistance(this.lastLat, this.lastLon, newLat, newLon);\n\t\t\t\t\t\tif (distance > 0.05) { // 50 meters\n\t\t\t\t\t\t\tthis.currentLat = newLat;\n\t\t\t\t\t\t\tthis.currentLon = newLon;\n\t\t\t\t\t\t\tthis.lastLat = newLat;\n\t\t\t\t\t\t\tthis.lastLon = newLon;\n\t\t\t\t\t\t\tthis.sendLocationUpdate();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\tconsole.error('Watch position error:', error);\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tenableHighAccuracy: true,\n\t\t\t\t\t\tmaximumAge: 5000,\n\t\t\t\t\t\ttimeout: 10000\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\n\t\t\tstopTracking() {\n\t\t\t\tif (this.watchId) {\n\t\t\t\t\tnavigator.geolocation.clearWatch(this.watchId);\n\t\t\t\t\tthis.watchId = null;\n\t\t\t\t}\n\t\t\t\tthis.isTracking = false;\n\t\t\t},\n\n\t\t\tsendLocationUpdate() {\n\t\t\t\tif (this.ws && this.ws.readyState === WebSocket.OPEN) {\n\t\t\t\t\tthis.loading = true;\n\t\t\t\t\tthis.ws.send(JSON.stringify({\n\t\t\t\t\t\tlatitude: this.currentLat,\n\t\t\t\t\t\tlongitude: this.currentLon,\n\t\t\t\t\t\tradius: this.radius\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\trefreshPOIs() {\n\t\t\t\tif (this.isTracking) {\n\t\t\t\t\tthis.sendLocationUpdate();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcalculateDistance(lat1, lon1, lat2, lon2) {\n\t\t\t\tconst R = 6371; // Earth's radius in km\n\t\t\t\tconst dLat = (lat2 - lat1) * Math.PI / 180;\n\t\t\t\tconst dLon = (lon2 - lon1) * Math.PI / 180;\n\t\t\t\tconst a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n\t\t\t\t\t\tMath.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n\t\t\t\t\t\tMath.sin(dLon/2) * Math.sin(dLon/2);\n\t\t\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n\t\t\t\treturn R * c;\n\t\t\t}\n\t\t}\n\t}\n\t</script>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
